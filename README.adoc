= CloudSim Plus: A Modern Java 8 Framework for Modeling and Simulation of Cloud Computing Infrastructures and Services
By Manoel C. Silva Filho, Raysa L. Oliveira, Claudio C. Monteiro, Pedro R. M. Inácio and Mário M. Freire.
:source-highlighter: coderay
:toc:
:imagesdir: images
:homepage: http://cloudsimplus.org

image::https://licensebuttons.net/l/by-sa/4.0/88x31.png[]
This work is licensed under a http://creativecommons.org/licenses/by-sa/4.0/[Creative Commons Attribution-ShareAlike 4.0 International License].

== Introduction
Cloud Computing is an important technology that has leveraged innovation in different knowledge fields and economic sectors by providing distributed, scalable, manageable and fault-tolerant computing resources over the Internet. The large adopotion of Cloud computing services can be also explained by diverse reasons such as its pay-per-use charging model that enables cost reduction for customers, the rapid and automated allocation of resources that enable applications to quickly respond to bursts, and full-featured web and console interfaces that enable customers to configure hosted services easily.

The advances brought by Cloud Computing are backup up by academy and industry research and have increasingly attracted new researchers. There are different issues to be addressed that makes Cloud to be an active research field, including SLA fulfillment, optimal VM placement and migration, cost reduction, power efficiency, hotspot detection, load balance, fault tolerance, anomalies detection, security enforcement, traffic and latency reduction and so on.

Considering the complexity of a Cloud infrastructure and the need to model proposed solutions and evaluate them in a quick, cheap and repeatable way, using a controlled environment that makes it easy to monitor and collect metrics, computer-based simulation is largely used to carry out research in this field.

Accordingly, in this article we present CloudSim Plus, a new, full-featured, re-designed, highly extensible and modern Java 8 framework to enable modeling and simulation of Cloud Computing infrastructure, services, underlying mechanisms and algorithms. CloudSim Plus enable researchers to model and simulate different Cloud scenarios, by implementing them using Java. Such scenarios can be used to experiment existing and potential solutions for the issues mentioned above. 

CloudSim Plus is an open source project available at http://cloudsimplus.org and http://cloudsimplus.org/docs/maven.html[Maven Central].

== Overview
CloudSim Plus is a simulation framework based on CloudSim 3, that went through an extensive re-design and re-engineering process to provide an updated, modern, more accurate, highly extensible, easier-to-use and state-of-the-art framework aiming sustainable maintainability for long-term evolution. To achieve such goals, CloudSim Plus is founded on several software design and engineering metrics, principles and practices such as https://en.wikipedia.org/wiki/Coupling_(computer_programming)[Coupling], https://en.wikipedia.org/wiki/Cohesion_(computer_science)[Cohesion], https://en.wikipedia.org/wiki/Software_design_pattern[Design Patterns], https://en.wikipedia.org/wiki/SOLID_(object-oriented_design)[SOLID principles] and other ones like https://pt.wikipedia.org/wiki/Don't_repeat_yourself[Don't Repeat Yourself (DRY)] and https://en.wikipedia.org/wiki/KISS_principle[KISS].

== Philosophy and Motivation
https://en.wikipedia.org/wiki/Software_quality[Software quality] has increasingly become essential for software industry, as can be seen by the number of current software design and development methodologies and processes such as https://en.wikipedia.org/wiki/Domain-driven_design[Domain-Driven Design (DDD)], https://en.wikipedia.org/wiki/Test-driven_development[Test-Driven Development (TDD)], https://en.wikipedia.org/wiki/Behavior-driven_development[Behavior-Driven Development (BDD)], Clean Code Programming and many more. Different tools have been used to collect and monitor software quality metrics to try detecting issues as soon as possible, such as https://en.wikipedia.org/wiki/Static_program_analysis[Static Code Analysis] and https://en.wikipedia.org/wiki/Integration_testing[Integration Testing] in an automated https://en.wikipedia.org/wiki/Continuous_integration[Continuous Integration] environment.

We understand that the same software quality pursued by the software industry must as well be pursued by academic projects to reduce https://en.wikipedia.org/wiki/Technical_debt[technical debt] and avoid https://en.wikipedia.org/wiki/Software_rot[software erosion], delivering industry-standard quality products.

We are strong adepts of open source philosophy and we started by effectively contributing to CloudSim in 2015. However, since CloudSim is not highly compliant with these software design and engineering principles, practices and philosophies and our team has different views of how the framework should evolve, we decided to start CloudSim Plus as an independent fork. We also believe that source code needs to be curated, without meaning it will restrict contributions, as it is successfully proved by important projects like the https://github.com/torvalds/linux[Linux Kernel].

Finally, enforcement of backward compatibility is a common concern in software development, mainly for public APIs such as those ones provided by a framework. However, such a concern slows down software evolution and we contrary understand that a cloud simulation framework is predominantly used for research purposes, even by industry. Cloud simulation scenarios are tightly coupled to a specific version of the simulation framework and after they produces the final results and the research goes on, new scenarios can be built using an updated version of the framework, without worrying about the older scenario. Accordingly, we are not afraid of breaking compatibility so that we can foster project advances.

== Architecture
CloudSim Plus is a Java Maven project that has a simpler and better module and package structures. The entire project is compounded of 4 modules that were re-organized to directly inherit from the parent project, allowing a researcher to quickly have an overview of the structure. Redundant and out-of-date modules such as "distribution" and "documentation" were removed since building distribution artifacts and documentation is already automated using Maven.

The figure below presents the current project architecture and its modules are described as follows. The highlighted modules are new in CloudSim Plus.

image::modules.png[title="CloudSim Plus Modules"]

=== Modules
CloudSim Plus API is the main module that contains the framework API. It is the only independent module that is required to build simulation scenarios. Since such a module is available at http://cloudsimplus.org/docs/maven.html[Maven Central], there is no need to manually download the source code to build simulations using the framework. This module can just be http://cloudsimplus.org#maven[added as a maven dependency to your own project] and you are ready to start building your simulation scenarios.

CloudSim Plus Examples provides the original CloudSim examples, with refactored, better organized code and updated to use the CloudSim Plus API. It also includes new examples for CloudSim Plus exclusive features. 

CloudSim Plus Testbeds modules provides some classes that implement simulation testbeds in a repeatable manner, allowing a researcher to collect valid scientific results, such as means and standard deviations, considering a specific confidence interval. They serve as examples on how to create broader testbed experiments.

CloudSim Plus Benchmarks module is used just internally to measure the overhead of some CloudSim Plus features. The interfaces are organized, from top to bottom, in the order required to create the objects that will represent the simulation scenario, including infrastructure, virtual machines and applications.

=== How CloudSim Plus works
Creating a cloud simulation using CloudSim Plus requires one to write a Java program to model the simulation scenario. The simplified diagram below presents the main interfaces involved in creating such scenarios. For every presented interface, there is one or more implementing classes that have to be actually instantiated.

image::reduced-main-classes.png[title="CloudSim Plus Simplified Class Diagram"]

The process of building a simulation scenario is described below. To see more details on how to use CloudSim Plus, please check the http://cloudsimplus.org/#how-to-use-cloudsim-plus:[How to use CloudSim Plus] section at the official website. A http://cloudsimplus.org/#a-minimal-and-complete-simulation-example:[minimal and complete simulation example] is available there too. 

The `CloudSim` class is the first one that needs to be instantiated to start building a cloud simulation. CloudSim Plus just requires it to be instantiated using the default, no-arguments constructor, to initialize the simulation. The next steps are described as follows.

==== Datacenter
Instances of a Datacenter should be created that will represent the different datacenters that compound the cloud infrastructure. Each Datacenter has a set of characteristics (such as its timezone and costs for charging customers) defined by a DatacenterCharacteristics object. It also must have a VmAllocationPolicy that defines the policy used to select a Host to place or migrate VMs.

For each Datacenter, a set of Hosts must be created, that represent the physical machines with actual computing power. Each Host must have a `VmScheduler` that defines the scheduling algorithm used by the Host to execute its VMs, existing 2 schedulers available. The `VmSchedulerTimeShared` enables executing VMs inside a Host in a preemptive, time-shared way, allowing different VMs to share CPU time when there are less CPUs than required by all VMs. The `VmSchedulerSpaceShared` is a non-preemptive scheduler that allocates physical CPUs to be exclusively used by each VM. If the current VMs require more CPUs than there are available, some VMs will not be allowed to be created.

For each Host, `ResourceProvisioners` objects must be set. They define the policy used by a Host to check whether is an specific amount of resource available for a requesting VM and to allocate that resource for such the VM is created. A `ResourceProvisioner` must be defined to manage the allocation of RAM, bandwidth and CPU from the Hosto to virtual machines.

- Network/Power Datacenter and Host

==== DatacenterBroker 
A Datacenter Broker is a software that receives requests from a cloud customer and is in charge to take required actions on behalf of the customer to attend such requests. Such requests usually are the creation and destruction of VMs and allocation of applications (called Cloudlets) inside some VM. The broker is accountable for some decision making, such as selecting a Datacenter and then a Host inside it to place each VM and mapping each Cloudlet to one of the available Vms. The instantiation of `DatacenterBrokers` is the next step, before creating and submitting VMs and Cloudlets to the cloud infrastructure.

The `DatacenterBrokerSimple` implementation always select the first Datacenter to place submitted Vms, before trying other Datacenters when the allocation of a Vm fails in such a Datacenter. It provides a https://en.wikipedia.org/wiki/Round-robin_scheduling:[Round-robin] policy to select a Vm to run each Cloudlet, without assessing Cloudlet requirements or provider and customer goals.

CloudSim Plus enable the `DatacenterBrokerSimple` enabling that such behaviours to be changed in runtime, allowing a researcher to define the policies to place Vms and map Cloudlets to Vms, according to desired goals, without requiring the creation of a new `DatacenterBroker`. More details are discussed in the next section. 

==== Vm
A `Vm` is a Virtual Machine that belongs to a specific cloud customer, that a `DatacenterBroker` acts on behalf of. It abstractly represents a Virtual Machine in terms of RAM, CPU, Storage and Bandwidth requirements. For each Vm, a `CloudletScheduler` must be set to define the scheduling policy to be used to run the applications inside the `Vm`. Beyond time- and space-shared schedulers, that work as the VmSchedulers used by Hosts, CloudSim Plus provides a implementation of the https://en.wikipedia.org/wiki/Completely_Fair_Scheduler:[Completely Fair Scheduler] used in recent Linux Kernels.

Vms must be created and submitted to the broker that will decide in which Datacenter and Host each Vm will be placed. When a Vm is submitted, try broker tries request a selected Datacenter to create the VM. If the Datacenter does not have a Host with enough capacity for a Vm, the broker then forwards the request to other Datacenters, until the Vm is created or all Datacenters are requested. 

- Network and Power Vms

==== Cloudlet 
A `Cloudlet` abstractly represents an application running inside a Vm. Cloudlets and its related interfaces such as the `UtilizationModel` are used to define application models. A Cloudlet must define some resource requirements in advance, currently only CPU and storage. Such requirements can be used by a broker to decide how to map Cloudlets to VMs in order to attend such requirements and achieve provider and customer goals. 

`UtilizationModels` define how different `Vm` resources will be used by a Cloudlet along the time, namely RAM, CPU and Bandwidth resources. Implementations such as the `UtilizationModelStochastic` allows defining resource usage in a random way, using some pseudo random number generator (PRNG). CloudSim Plus enables a researcher to define the PRNG implementation to use, following a statistical distribution that attends his/her goals.

Cloudlet resource utilization can also be defined using the `UtilizationModelPlanetLabInMemory` class, that allows defining the usage based on a trace file from https://www.planet-lab.org:[Planet Lab Datacenters]. By the other hand, the `WorkloadModel` interface enables the creation of an entire set of `Cloudlets` based on different Datacenter traces file formats. Currently only the http://www.cs.huji.ac.il/labs/parallel/workload/:[Standard Workload Format] from
new.huji.ac.il/en:[The Hebrew University of Jerusalem] is implemented.

- Network Cloudlets

== Exclusive Characteristics and Features
CloudSim Plus is a full-featured simulation framework which has introduced long-waited and exclusive features, that are presented below. It is also included discussions about how such features can be used. 

=== Dynamic creation of VMs and Applications (Cloudlets)
CloudSim Plus allows on-demand creation of VMs and Cloudlets, without requiring creation of Datacenter Brokers at runtime. The `DatacenterBroker` class was updated enable submission of new VMs and Cloudlets during simulation execution and accordingly request the creation of such objects into the Cloud infrastructure.

It also enables delaying the creation of submitted Cloudlets for simulation of dynamic arrival of tasks.

=== VM Scaling
VM migration is a well-known mechanism used to optimize allocation of physical resources, that can be applied for different goals such as reduction of costs, energy consumption and resource wastage by consolidating multiple VMs into the same Host, reduction of network traffic by placing inter-communication VMs as close as possible, reduction of SLA violations by ensuring that the required resources will be available for hosted VMs, etc.

However, VM migration is an expensive operation that causes service downtime, introduces overhead and must be performed carefully. Sometimes VM migrations can be avoided by simply scaling under or overloaded VMs. CloudSim Plus provides vertical and horizontal VM scaling mechanisms. 

These two different kinds of VM scaling, additionally with well-known VM migration algorithms, can be used selectively by a https://en.wikipedia.org/wiki/Hypervisor:[Hypervisor] to provide a very efficient VM allocation policy mechanism to define when it is time to vertically scale, horizontally scale or migrate a VM. Depending on specific conditions, one action can be favored over other ones or even different actions can be performed at a given time.

CloudSim Plus VM Scaling mechanisms as discussed below.

==== Vertical VM Scaling
Vertical VM Scaling performs on-demand down or up allocation of VM resources such as Ram, Bandwidth and CPUs, according to under or overloaded VM condition, respectively. Since current hypervisors such as http://www.linux-kvm.org/page/Projects/auto-ballooning:[KVM] and VMware ESX allows dynamically changing allocation of https://labs.vmware.com/vmtj/memory-overcommitment-in-the-esx-server:[RAM] and https://pubs.vmware.com/vsphere-4-esx-vcenter/index.jsp?topic=/com.vmware.vsphere.vmadmin.doc_41/vsp_vm_guide/configuring_virtual_machines/t_change_cpu_hotplug_settings.html:[CPU] for a VM, that can be used to avoid VM migration in specific conditions.

Bandwidth scaling is simpler to be performed since it is a more abstract resource, different from virtualized RAM and CPU that are linked to the physical corresponding resource from a physical machine. By this way, such a scaling can be easily performed in routers and CloudSim Plus simulate such a scaling mechanism.

Using Vertical VM Scaling feature it is possible to accomodate rising demand of applications running inside a VM, without migrating the VM or creating another ones. Such a CloudSim Plus feature enables performing simulations to assess, for instance, what is the workload limit that a VM supports, for a given application model, before requiring the creation of new VMs to balance the load, that is discussed in the next sub-section. 

==== Horizontal VM Scaling
Horizontal VM Scaling allows the dynamic destruction or creation of VMs, according to an under or overload condition, respectively. Such conditions are defined by a https://en.wikipedia.org/wiki/Predicate_(mathematical_logic):[predicate] that can check different VM resources usage such as CPU, RAM or Bandwidth, to define if a VM is under or overloaded.

Depending on the model of an application running inside a VM, by just performing a vertical up scaling when the VM is overloaded may not be enough to support the demand. Consider a web application relying on a Database Management Systems (DBMS) and a Web/Application Server. Often, it is required to create new VMs running separate instances of a Web/Application Server to distribute user requests among them. It may be not enough just assigning more CPUs or RAM to a VM, in an attempt to enable more threads to process user requests. Usually a single process may have difficult to handle so many threads. Alternatively, Horizontal VM Scaling comes in handy by allowing cloning a VM to balance the load.

This feature allows a researcher to implement and evaluate load balancing algorithms for dynamic workloads and burst conditions, by enabling the creation of new VMs to attend the demand. Some cloud platforms such as Amazon Web Services provide an https://aws.amazon.com/autoscaling/:[Auto Scaling] feature, that can be similarly simulated in CloudSim Plus.

=== Parallel execution of simulations
Allows several simulations to be run simultaneously, in a isolated way, inside a multi-core computer.

=== Listeners
Listeners objects to enable simulation monitoring.

=== Builders
Builders to enable creating multiple simulation objects with same configuration.

=== TableBuilder 
objects that are used in all examples and enable printing simulation results in different formats such as ASCII Table, CSV or HTML. It shows simulation results in perfectly aligned tables, including data units and additional data. See the last line of the [BasicFirstExample](/cloudsim-plus-examples/src/main/java/org/cloudsimplus/examples/BasicFirstExample.java) constructor to see how it is easy to print results.

=== Strongly object-oriented 
framework that creates relationships among classes and allows chained calls such as `cloudlet.getVm().getHost().getDatacenter()`.
   And guess what? You don't even have to worry about `NullPointerException` when making such a chained call because CloudSim Plus uses the [Null Object Design Pattern](https://en.wikipedia.org/wiki/Null_Object_pattern) to avoid that.

=== Classes and interfaces to allow implementation of [heuristics]
(http://en.wikipedia.org/wiki/Heuristic) such as 
    [Tabu Search](http://en.wikipedia.org/wiki/Tabu_search), [Simulated Annealing](http://en.wikipedia.org/wiki/Simulated_annealing), 
    [Ant Colony Systems](http://en.wikipedia.org/wiki/Ant_colony_optimization_algorithms) and so on. See an [example using Simulated Annealing here](/cloudsim-plus-examples/src/main/java/org/cloudsimplus/examples/DatacenterBrokerHeuristicExample.java).

=== Implementation of the Completely Fair Scheduler
(/cloudsim-plus-examples/src/main/java/org/cloudsimplus/examples/LinuxCompletelyFairSchedulerExample.java) used in recent version of the Linux Kernel.

=== Completely re-designed and reusable Network module. Totally refactored network examples to make them clear and easy to change 
\(see issue \#49\).

=== Throughout documentation update, improvement and extension.

=== Improved class hierarchy, modules and package structure that is easier to understand and follows the Separation of Concerns principle \(SoC\).

=== As it is usual to extend framework classes to provide some specific behaviours for your simulations, you will find a totally refactored code that follows clean code programming, [SOLID](https://en.wikipedia.org/wiki/SOLID_(object-oriented_design)\), [Design Patterns](https://en.wikipedia.org/wiki/Software_design_pattern) and several other software engineering principles and practices. By this way, it will be far easier to understand the code and implement the feature you want.

=== Integration Tests to increase framework accuracy by testing entire simulation scenarios.

=== Updated to Java 8, making extensive use of [Lambda Expressions](http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/Lambda-QuickStart/index.html) and [Streams API](http://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html) to improve efficiency and provide a cleaner and easier-to-maintain code.

== Current Issues (inherited from CloudSim)

== Conclusion and Future Work

== Acknowledge

* CAPES, FCT, IT, UBI, EU/Brazil Cloud Forum.